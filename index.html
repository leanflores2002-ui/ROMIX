<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Romix - Colección Invierno 2025</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" integrity="sha512-b7ZPnUPQK1G3z2d4l0f7Gm2M1eJp4z8f5s1p9o3r2x6z0kYd8l9r4Qv5B1c2D3E4F5G6H7I8J9K0L1M2N3O4PQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>

    /* === Estados de talles (según disponibilidad) === */
    .size-chip { position: relative; padding: 6px 10px; border-radius: 10px; font-weight: 700; border: 1px solid #ddd; cursor: pointer; user-select: none; }
    .size-chip[data-state="available"] { background: var(--success); color: #fff; }
    .size-chip[data-state="low"] { background: var(--warning); color: #212529; }
    .size-chip[data-state="out"] { background: #6c757d; color: #fff; text-decoration: line-through; cursor: not-allowed; }
    .size-chip .badge { display:none !important; }
    .size-chip[data-state="available"] .badge { background: var(--success); color: #fff; }
    .size-chip[data-state="low"] .badge { background: var(--warning); color: #212529; }
    .size-chip[data-state="out"] .badge { background: var(--danger); color: #fff; }
    .size-chip.selected { outline: 2px solid #343a40; }
    .product-selection-status { margin: 8px 0 4px; font-size: .9rem; color: #495057; }
    .btn[aria-disabled="true"] { opacity: .6; cursor: not-allowed; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .skip-link:focus { left: 12px; top: 12px; z-index: 9999; background: #fff; color: #000; padding: 8px 10px; border-radius: 8px; position: absolute; }
    /* Search */
    .global-search { display:flex; align-items:center; gap:8px; margin-left: 10px; }
    .global-search input[type="search"] { padding:6px 10px; border:1px solid #ddd; border-radius:8px; min-width: 220px; color:#212529; background:#fff; caret-color: var(--secondary); }
    .global-search input[type="search"]::placeholder { color:#6c757d; }
    .global-search button { padding: 7px 12px; border-radius:8px; border:1px solid var(--primary); background:#fff; color: var(--primary); cursor:pointer; }
    .search-highlight { outline: 3px solid #ffc107; outline-offset: 2px; border-radius: 10px; }
    .global-search { position: relative; }
    .search-suggestions { position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,.12); padding:6px 0; z-index:2001; }
    .search-suggestion { display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer; }
    .search-suggestion i { color:#adb5bd; }
    .search-suggestion:hover, .search-suggestion.active { background:#f1f3f5; }
    .search-suggestion .t { line-height:1.1; }
    .search-suggestion small { color:#6c757d; }

    :root {
      --primary: #e83e8c; --secondary: #6f42c1; --light: #f8f9fa; --dark: #343a40;
      --success: #28a745; --danger: #dc3545; --warning: #ffc107;
      --radius: 10px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f5f5f5; color: #333; }
    header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; padding: 20px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,.1); }
    .header-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .contact-header { display: flex; align-items: center; gap: 10px; }
    .whatsapp-header { background-color: #25D366; color: #fff; padding: 8px 15px; border-radius: 20px; text-decoration: none; display: inline-flex; align-items: center; font-weight: 700; gap: 6px; }
    .cart-icon-btn { position: relative; display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 8px 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,.4); background: rgba(0,0,0,.1); color: #fff; cursor: pointer; }
    .cart-icon-btn:focus-visible { outline: 3px solid #fff; outline-offset: 2px; }
    #cart-count { background: var(--danger); color: #fff; border-radius: 999px; padding: 0 6px; font-size: .8rem; position: absolute; top: -8px; right: -8px; min-width: 18px; text-align: center; }

    nav { display: none; }
    .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .nav-menu { display: flex; list-style: none; overflow-x: auto; white-space: nowrap; }
    .nav-menu li a { display: block; padding: 15px 20px; color: var(--dark); text-decoration: none; font-weight: 600; transition: .3s; }
    .nav-menu li a i { margin-right: 6px; }
    .nav-menu li a:hover, .nav-menu li.active a { color: var(--primary); }
    .nav-menu li.active a { border-bottom: 3px solid var(--primary); }

    /* Inline header links style (foto 1) */
    .nav-inline ul { list-style: none; display: flex; gap: 10px; padding: 0; margin: 0; }
    .nav-inline a { color: #fff; text-decoration: none; padding: 8px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.35); background: rgba(255,255,255,.08); }

    .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    .section-title { font-size: 1.8rem; color: var(--secondary); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; display: flex; align-items: center; gap: 10px; }

    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .product-card { background: #fff; border-radius: var(--radius); overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,.1); transition: transform .3s, box-shadow .3s; position: relative; }
    .product-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,.15); }
    .product-image { height: 260px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; position: relative; }
    .product-image img { max-width: 90%; max-height: 90%; object-fit: contain; }
    .product-badge { position: absolute; top: 10px; right: 10px; background: var(--primary); color: #fff; padding: 5px 10px; border-radius: 20px; font-size: .8rem; font-weight: 700; }
    .product-info { padding: 15px; }
    .product-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; color: var(--dark); height: 50px; overflow: hidden; }
    .product-price { font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 10px; }
    .product-price small { font-size: .9rem; color: #6c757d; text-decoration: line-through; margin-left: 5px; }

    .product-colors, .size-options { display: flex; flex-wrap: wrap; gap: 6px; }
    .color-option { width: 22px; height: 22px; border-radius: 50%; border: 1px solid #ddd; cursor: pointer; outline: none; }
    .color-option.selected { box-shadow: 0 0 0 2px var(--primary); }
    .size-option { padding: 5px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: .85rem; cursor: pointer; }
    .size-option:hover { border-color: var(--primary); }
    .size-option.selected { border: 2px solid var(--primary); }
    .size-option.unavailable { background: #f8f9fa; color: #6c757d; text-decoration: line-through; cursor: not-allowed; }

    .quantity-control { display: flex; align-items: center; gap: 6px; margin: 10px 0; }
    .quantity-title { font-size: .9rem; color: #6c757d; }
    .quantity-btn { padding: 6px 10px; font-size: .9rem; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 6px; }
    .quantity-input { width: 56px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }

    .product-actions { display: flex; gap: 10px; }
    .btn { padding: 8px 15px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-danger { background: var(--danger); color: #fff; }

    .contact-section, .cart-section { background: #fff; border-radius: var(--radius); padding: 30px; margin-top: 40px; box-shadow: 0 3px 10px rgba(0,0,0,.1); }
    .cart-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .cart-table th, .cart-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    .cart-table th { background: var(--light); font-weight: 700; color: var(--secondary); }
    .cart-total { margin-top: 20px; font-size: 1.3rem; font-weight: 700; text-align: right; color: var(--primary); }
    .cart-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 2000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: var(--radius); width: 95%; max-width: 720px; box-shadow: 0 5px 15px rgba(0,0,0,.3); }
    .modal-content h3 { margin-bottom: 15px; color: var(--secondary); }
    .modal-row { display: grid; grid-template-columns: 240px 1fr; gap: 18px; align-items: start; }
    .modal-thumb { width: 240px; height: 240px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .modal-thumb img { width: 100%; height: 100%; object-fit: contain; }
    .summary { background: #fafafa; border: 1px solid #eee; border-radius: 8px; padding: 12px; margin-top: 10px; font-size: .95rem; }
    .price-line { display: flex; justify-content: space-between; margin-top: 8px; }
    .modal-content label { display: block; margin: 12px 0 6px; font-weight: 700; }
    .modal-content select, .modal-content input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
    .modal-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .hidden { display: none; }

    footer { background: var(--dark); color: #fff; padding: 30px 0; margin-top: 50px; }
    .footer-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 30px; }
    .footer-column h4 { font-size: 1.2rem; margin-bottom: 15px; color: var(--primary); }
    .footer-column ul { list-style: none; }
    .footer-column ul li { margin-bottom: 10px; }
    .footer-column ul li a { color: #adb5bd; text-decoration: none; transition: color .3s; }
    .footer-column ul li a:hover { color: #fff; }
    .social-links { display: flex; gap: 15px; margin-top: 15px; }
    .social-links a { color: #fff; background: #495057; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color .3s; }
    .social-links a:hover { background: var(--primary); }
    .copyright { text-align: center; padding-top: 20px; margin-top: 20px; border-top: 1px solid #495057; color: #adb5bd; font-size: .9rem; }

    @media (max-width:768px) {
      .header-container { flex-direction: column; text-align: center; gap: 10px; }
      .products-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
      .cart-table { font-size: .85rem; }
      .modal-row { grid-template-columns: 1fr; }
      .modal-thumb { width: 100%; height: 260px; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
    }
    /* Visual refresh to match product detail */
    body { background: #fff1f6; }
    header { box-shadow: 0 4px 14px rgba(0,0,0,.12); }
    .global-search input[type="search"] { padding:10px 14px; border:1px solid rgba(255,255,255,.6); background:rgba(255,255,255,.15); color:#fff; border-radius:999px; min-width:260px; outline:none; }
    .global-search input::placeholder { color:#f8f9fa; opacity:.85; }
    .global-search button { padding:8px 14px; border-radius:999px; border:1px solid rgba(255,255,255,.6); background:#fff; color:var(--primary); cursor:pointer; font-weight:700; }
    .hero { background: transparent; padding: 16px 0 10px; text-align:center; }
    .hero h1 { font-size: 2.2rem; color:#1b1f24; margin: 4px 0 6px; font-weight: 900; }
    .hero p { color:#6c757d; max-width: 760px; margin: 0 auto; }
    /* Filter bar */
    .filter-bar { margin: 8px 0 18px; }
    .filter-card { background:#fff; border-radius:14px; box-shadow:0 14px 36px rgba(0,0,0,.10); padding: 14px; }
    .filter-top { display:flex; align-items:center; gap:12px; }
    .filter-search { flex:1; display:flex; align-items:center; gap:8px; background:#fff; border:1px solid #eee; border-radius:999px; padding:8px 12px; box-shadow: inset 0 0 0 1px #f0f2f4; }
    .filter-search i { color:#adb5bd; }
    .filter-search input { width:100%; border:none; outline:none; font-size: .95rem; }
    .filter-toggle { border:none; background:#fff; color:var(--primary); font-weight:800; cursor:pointer; padding:8px 12px; border-radius:10px; display:inline-flex; align-items:center; gap:8px; }
    .filter-body { margin-top:12px; border-top:1px solid #f1f3f5; padding-top:12px; }
    .filters-row { display:flex; flex-direction:column; gap:10px; }
    .filters-title { color:#1b1f24; }
    .filters-subtitle { color:#6c757d; font-weight:700; margin-top:4px; }
    .filters-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:12px; }
    .filters-grid label { display:flex; flex-direction:column; gap:6px; font-weight:700; color:#495057; }
    .filters-grid input, .filters-grid select { padding:8px 10px; border:1px solid #e9ecef; border-radius:8px; }
    .filters-actions { display:flex; align-items:end; }
    .filter-chips { display:flex; flex-wrap:wrap; gap:10px; }
    .filter-chips label { background:#f5f6f9; border:1px solid #e9ecef; border-radius:999px; padding:6px 10px; display:inline-flex; align-items:center; gap:6px; cursor:pointer; font-weight:600; }
    .filter-chips input { accent-color: var(--primary); }
    .no-results { margin-top:12px; display:flex; align-items:center; gap:12px; justify-content:center; color:#6c757d; }
    .no-results i { font-size:28px; color:#adb5bd; }
    .no-results .tip { font-size:.9rem; }
    .products-grid { gap: 24px; }
    .product-card { border-radius: 14px; box-shadow: 0 14px 36px rgba(0,0,0,.10); }
    .product-image { height: 300px; background:#f8f9fb; }
    .product-title { font-size: 1.15rem; color:#111; }
    .product-price { font-size: 1.25rem; color: var(--secondary); font-weight: 800; }
    .btn.btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); box-shadow: 0 8px 18px rgba(111,66,193,.25); }
  </style>
</head>
<body
  onerror="console.error('window error', event)">
  <a class="skip-link" href="#mujer" style="position:absolute;left:-9999px;top:auto;">Saltar al contenido</a>
  <header>
    <div class="header-container">
      <div class="logo" aria-label="Romix"><i class="fas fa-store" aria-hidden="true"></i><span>ROMIX</span></div>
      <div class="nav-inline" aria-label="Secciones">
        <ul>
          <li><a href="mujer.html">Mujer</a></li>
          <li><a href="hombre.html">Hombre</a></li>
          <li><a href="ninos.html">Niños</a></li>
          <li><a href="ayuda.html">Ayuda</a></li>
        </ul>
      </div>
      <div class="contact-header">
        <button type="button" class="cart-icon-btn" onclick="toggleCart()" aria-haspopup="region" aria-controls="cart" aria-expanded="false">
          <i class="fas fa-shopping-cart" aria-hidden="true"></i>
          <span>Carrito</span>
          <span id="cart-count" aria-live="polite">0</span>
        </button>
        <form id="global-search-form" class="global-search" role="search" aria-label="Buscar productos">
          <input type="search" name="q" placeholder="Buscar producto..." aria-label="Buscar producto" />
          <button type="submit"><i class="fas fa-search" aria-hidden="true"></i> Buscar</button>
        </form>
      </div>
    </div>
  </header>

  <nav aria-label="Principal">
    <div class="nav-container">
      <ul class="nav-menu">
        <li class="active"><a href="mujer.html"><i class="fas fa-female" aria-hidden="true"></i> Mujer</a></li>
        <li><a href="hombre.html"><i class="fas fa-male" aria-hidden="true"></i> Hombre</a></li>
        <li><a href="ninos.html"><i class="fas fa-child" aria-hidden="true"></i> Niños</a></li>
        <li><a href="#contacto"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Contacto</a></li>
        <li><a href="ayuda.html"><i class="fas fa-question-circle" aria-hidden="true"></i> Ayuda</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <section class="hero" aria-label="Presentación catálogo">
      <h1>Catálogo ROMIX</h1>
      <p>Encontrá calzas, tops, camperas y más. Seleccioná color y talle, revisá disponibilidad en vivo y sumalo al carrito.</p>
    </section>

    <section class="filter-bar" aria-label="Barra de filtros">
      <div class="filter-card">
        <div class="filter-top">
          <div class="filter-search">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input id="filter-q" type="search" placeholder="Buscar prendas..." aria-label="Buscar prendas" />
          </div>
          <button id="filter-toggle" class="filter-toggle" type="button"><i class="fas fa-sliders-h" aria-hidden="true"></i> <span>Mostrar filtros</span></button>
        </div>
        <div id="filter-body" class="filter-body hidden" aria-hidden="true">
          <div class="filters-row">
            <strong class="filters-title">Filtros</strong>
            <div class="filters-grid">
              <label>Sección
                <select id="filter-section">
                  <option value="all">Todas</option>
                  <option value="mujer">Mujer</option>
                  <option value="hombre">Hombre</option>
                  <option value="ninos">Niños</option>
                </select>
              </label>
              <label>Precio Mínimo
                <input id="filter-price-min" type="number" min="0" value="0" inputmode="numeric" />
              </label>
              <label>Precio Máximo
                <input id="filter-price-max" type="number" min="0" value="999999" inputmode="numeric" />
              </label>
              <label>Disponibilidad
                <select id="filter-availability">
                  <option value="all">Todos</option>
                  <option value="available">Disponible</option>
                  <option value="low">Por agotarse</option>
                  <option value="out">Agotado</option>
                </select>
              </label>
              <div class="filters-actions">
                <button id="filter-apply" type="button" class="btn btn-primary"><i class="fas fa-search" aria-hidden="true"></i> Aplicar filtros</button>
              </div>
            </div>
            <div class="filters-subtitle">Tipo</div>
            <div class="filter-chips" id="filter-types">
              <label><input type="checkbox" value="calzas"/> Calzas</label>
              <label><input type="checkbox" value="oxford"/> Oxford</label>
              <label><input type="checkbox" value="pantalones"/> Pantalones</label>
              <label><input type="checkbox" value="capri"/> Capri</label>
              <label><input type="checkbox" value="ciclistas"/> Ciclistas</label>
              <label><input type="checkbox" value="shorts"/> Shorts</label>
              <label><input type="checkbox" value="remeras"/> Remeras</label>
              <label><input type="checkbox" value="musculosas"/> Musculosas</label>
              <label><input type="checkbox" value="bermudas"/> Bermudas</label>
              <label><input type="checkbox" value="tops"/> Tops</label>
              <label><input type="checkbox" value="camperas"/> Camperas</label>
              <label><input type="checkbox" value="buzos"/> Buzos</label>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div id="feedback" class="hidden" role="status" aria-live="polite" style="margin-bottom:10px;color:#c00;"></div>

    <section id="cart" class="cart-section hidden" role="region" aria-label="Carrito de compras">
      <h2 class="section-title"><i class="fas fa-shopping-cart" aria-hidden="true"></i> Carrito de Compras</h2>
      <table class="cart-table">
        <thead>
          <tr>
            <th>Producto</th><th>Tipo</th><th>Color</th><th>Talle</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cart-items"></tbody>
      </table>
      <div class="cart-total">Total: $<span id="cart-total">0</span></div>
      <div class="cart-actions">
        <button class="btn btn-danger" type="button" onclick="clearCart()"><i class="fas fa-trash" aria-hidden="true"></i> Vaciar Carrito</button>
        <button class="btn btn-success" type="button" onclick="sendToWhatsApp()"><i class="fab fa-whatsapp" aria-hidden="true"></i> Enviar Pedido</button>
      </div>
    </section>

    <section id="mujer">
      <h2 class="section-title"><i class="fas fa-female" aria-hidden="true"></i> Ropa para Mujer</h2>
      <div class="products-grid" id="mujer-grid"></div>
    </section>

    <section id="hombre">
      <h2 class="section-title"><i class="fas fa-male" aria-hidden="true"></i> Ropa para Hombre</h2>
      <div class="products-grid" id="hombre-grid"></div>
    </section>

    <section id="ninos">
      <h2 class="section-title"><i class="fas fa-child" aria-hidden="true"></i> Ropa para Niños</h2>
      <div class="products-grid" id="ninos-grid"></div>
    </section>

    <section id="contacto" class="contact-section">
      <h2 class="section-title"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Contacto y Ubicación</h2>
      <div class="contact-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;">
        <div class="contact-info">
          <h3>Información de contacto</h3>
          <p><i class="fas fa-store" aria-hidden="true"></i> <strong>Tienda física:</strong> Concordia 514 local b, CABA</p>
          <p><i class="fas fa-phone" aria-hidden="true"></i> <strong>Teléfono:</strong> <a href="tel:+5491154272065">+54 9 11 5427-2065</a></p>
          <p><i class="fab fa-whatsapp" aria-hidden="true"></i> <strong>WhatsApp:</strong> <a href="https://wa.me/5491154272065" target="_blank" rel="noopener noreferrer">+54 9 11 5427-2065</a></p>
          <p><i class="fas fa-envelope" aria-hidden="true"></i> <strong>Email:</strong> <a href="mailto:info@romix.com.ar">info@romix.com.ar</a></p>
          <div class="business-hours">
            <h3>Horarios de atención</h3>
            <ul>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Lunes a Viernes</span> <span>7:00 - 16:30 hs</span></li>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Sábados</span> <span>7:00 - 12:30 hs</span></li>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Domingos</span> <span>Cerrado</span></li>
            </ul>
          </div>
        </div>
        <div class="contact-info">
          <h3>Formas de Pago</h3>
          <p><i class="fas fa-money-bill-wave" aria-hidden="true"></i> Efectivo, Transferencia, Mercado Pago</p>
          <h3 style="margin-top: 20px;">Seguinos en redes</h3>
        </div>
      </div>
    </section>
  </div>

  <!-- MODAL -->
  <div id="review-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="review-title" aria-hidden="true">
    <div class="modal-content animate__animated animate__fadeIn" tabindex="-1">
      <h3 id="review-title">Revisar pedido</h3>
          <div class="modal-row">
            <div class="modal-thumb"><img id="review-image" alt="Producto seleccionado" onerror="this.onerror=null; this.src='images/placeholder.jpg';" /></div>
        <div>
          <div class="summary">
            <p><strong id="review-name">Producto</strong> <span id="review-type" style="color:#6c757d"></span></p>
            <div class="price-line"><span>Precio unitario</span><strong>$<span id="review-price" data-unit-price="0">0</span></strong></div>
            <div class="price-line"><span>Subtotal</span><strong>$<span id="review-subtotal">0</span></strong></div>
            <p id="review-stock" style="margin-top:6px;color:#6c757d;">Stock disponible: -</p>
          </div>

          <label for="review-color">Color</label>
          <select id="review-color"></select>

          <label for="review-size">Talle</label>
          <select id="review-size"></select>

          <label for="review-qty">Cantidad</label>
          <div class="quantity-control" style="margin-top:4px;">
            <button class="btn quantity-btn" id="qty-dec" type="button" aria-label="Disminuir cantidad">−</button>
            <input type="number" id="review-qty" class="quantity-input" min="1" value="1" />
            <button class="btn quantity-btn" id="qty-inc" type="button" aria-label="Aumentar cantidad">+</button>
          </div>

          <div class="modal-actions">
            <button class="btn btn-outline" type="button" onclick="closeReviewModal()">Cancelar</button>
            <button class="btn btn-primary" type="button" onclick="confirmReviewToCart()"><i class="fas fa-check" aria-hidden="true"></i> Confirmar compra</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-container">
      <div class="footer-column">
        <h4>Productos</h4>
        <ul>
          <li><a href="mujer.html">Ropa para Mujer</a></li>
          <li><a href="hombre.html">Ropa para Hombre</a></li>
          <li><a href="ninos.html">Ropa para Niños</a></li>
          <li><a href="#">Novedades</a></li>
          <li><a href="#">Ofertas</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Ayuda</h4>
        <ul>
          <li><a href="ayuda.html#size-guide">Guía de talles</a></li>
          <li><a href="ayuda.html#returns">Cambios</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Contacto</h4>
        <ul>
          <li><a href="#contacto">Dirección y horarios</a></li>
          <li><a href="https://wa.me/5491154272065" target="_blank" rel="noopener noreferrer">WhatsApp</a></li>
          <li><a href="tel:+5491154272065">Llamar por teléfono</a></li>
          <li><a href="mailto:info@romix.com.ar">Enviar email</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright"><p>&copy; 2025 Romix - Todos los derechos reservados</p></div>
  </footer>

  <script>
    // ===== Estado seguro de localStorage =====
    function safeGetCart() {
      try { return JSON.parse(localStorage.getItem('cart')) || []; } catch { return []; }
    }
    function safeSetCart(value) {
      try { localStorage.setItem('cart', JSON.stringify(value)); } catch {}
    }

    let cart = safeGetCart();
    let currentType = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      updateCart();
      // Normaliza algunos textos estáticos con codificación rota
      try {
        document.querySelectorAll('.nav-menu a').forEach(a => {
          a.innerHTML = a.innerHTML.replace('Ni��os','Niños').replace('Ni�os','Niños');
        });
        document.title = document.title.replace('Colecci��n','Colección').replace('Colecci�n','Colección');
      } catch {}
      // Si viene de ayuda con #cart o ?cart=1, abrir carrito
      try {
        const wantsCart = location.hash === '#cart' || /[?&]cart=1\b/.test(location.search);
        if (wantsCart) {
          const sec = document.getElementById('cart');
          if (cart && cart.length && sec) {
            sec.classList.remove('hidden');
            const btn = document.querySelector('.cart-icon-btn');
            btn && btn.setAttribute('aria-expanded', 'true');
            setTimeout(()=>sec.scrollIntoView({behavior:'smooth', block:'start'}), 50);
          }
        }
      } catch {}
      // Cerrar modal con ESC y clic fuera
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeReviewModal(); });
      document.getElementById('review-modal').addEventListener('click', (e) => {
        if (e.target.id === 'review-modal') closeReviewModal();
      });
    });

    function showError(msg) {
      const fb = document.getElementById('feedback');
      fb.textContent = msg; fb.classList.remove('hidden');
      setTimeout(() => fb.classList.add('hidden'), 4000);
    }

    // Normaliza textos con acentos mal codificados en contenido dinámico (visual)
    function fixText(s) {
      if (!s || typeof s !== 'string') return s;
      const pairs = [
        ['Ni�os','Niños'], ['Ni�a','Niña'], ['Ni�o','Niño'],
        ['T�rmica','Térmica'], ['T�rmico','Térmico'],
        ['Marr�n','Marrón'], ['Pantal�n','Pantalón'], ['Algod�n','Algodón'],
        ['Selecci�n','Selección'], ['seleccion�','seleccioná'],
        ['p�gina','página'], ['est�','está'], ['agreg�','agregó'], ['vac�o','vacío']
      ];
      let out = s;
      for (const [a,b] of pairs) out = out.split(a).join(b);
      return out;
    }

    function loadProducts() {
      return fetch('products.json').catch(err => { console.error('[ROMIX] fetch products.json failed:', err); const b=document.getElementById('load-error-banner'); if(b)b.style.display='block'; return new Response(JSON.stringify([]), {headers:{'Content-Type':'application/json'}}); })
        .then((r) => r.json())
        .then((products) => {
          const sections = {
            mujer: document.getElementById('mujer-grid'),
            hombre: document.getElementById('hombre-grid'),
            ninos: document.getElementById('ninos-grid')
          };

          products.forEach((product) => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.type = product.type;
            card.dataset.product = JSON.stringify(product);

            let priceHTML = `$${Number(product.price).toLocaleString('es-AR')}`;
            if (product.originalPrice) {
              priceHTML += ` <small>$${Number(product.originalPrice).toLocaleString('es-AR')}</small>`;
            }
            const badgeHTML = product.badge ? `<span class="product-badge">${product.badge}</span>` : '';

            const colorsHTML = (product.colors || []).map((color) => {
              const border = color.hex === '#ffffff' ? 'border:1px solid #ddd;' : '';
              const cname = fixText(color.name);
              return `<div class="color-option" role="button" tabindex="0" aria-label="Color ${cname}" style="background-color:${color.hex};${border}" title="${cname}" data-color="${cname}"></div>`;
            }).join('');

            const __sizes = (() => { const seen = new Set(); const out = []; (product.sizes || []).forEach(s=>{ const k=String(s.size); if(!seen.has(k)){ seen.add(k); out.push(s); } }); return out; })();
            const sizesHTML = __sizes.map((s) => {
              const unavailable = s.status === 'unavailable';
              return `<span class="size-option ${s.status}" role="button" ${unavailable ? 'aria-disabled="true"' : ''} tabindex="0" data-size="${s.size}">${s.size}</span>`;
            }).join('');

            card.innerHTML = `
              <div class="product-image">
                <img src="${product.image || 'images/placeholder.jpg'}" onerror="this.onerror=null; this.src='images/placeholder.jpg';" alt="${fixText(product.name)}" loading="lazy" />
                ${badgeHTML}
              </div>
              <div class="product-info">
                <h3 class="product-title" style="cursor:pointer;">${fixText(product.name)}</h3>
                <div class="product-price">${priceHTML}</div>
                <div class="product-colors">${colorsHTML}</div>
                <div class="product-sizes">
                  <div class="size-title">Talles disponibles:</div>
                  <div class="size-options">${sizesHTML}</div>
                </div>
                <div class="quantity-control">
                  <span class="quantity-title">Cantidad:</span>
                  <button class="btn quantity-btn decrease" type="button" aria-label="Disminuir cantidad">-</button>
                  <input type="number" class="quantity-input" min="1" value="1" inputmode="numeric" />
                  <button class="btn quantity-btn increase" type="button" aria-label="Aumentar cantidad">+</button>
                </div>
                <div class="product-selection-status" aria-live="polite">Sin selección</div>
                <div class="product-stock-note" aria-label="Stock total disponible" style="font-size:.8rem;color:#6c757d;margin-top:2px;"></div>
                <div class="product-actions">
                  <button class="btn btn-primary" type="button" aria-disabled="true" disabled>Comprar</button>
                </div>
              </div>`;

            sections[product.section].appendChild(card);
            const stockNote = card.querySelector('.product-stock-note');
            if (stockNote) {
              const total = computeTotalStock(product);
              const label = total === 1 ? '1 unidad' : (total + ' unidades');
              stockNote.textContent = 'Stock total: ' + label;
            }
            // Inicializar galería y precio base
            initGallery(card, product);
            updateCardPrice(card, product);

            // Eventos
            card.querySelectorAll('.color-option').forEach((el) => {
              el.addEventListener('click', () => selectColor(el));
              el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectColor(el); } });
            });
            card.querySelectorAll('.size-option').forEach((el) => {
              el.addEventListener('click', () => selectSize(el));
              el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectSize(el); } });
            });
            initQtyControls(card);
            card.querySelector('.btn.btn-primary').addEventListener('click', (e) => {
              const btn = e.currentTarget;
              if (btn.disabled || btn.getAttribute('aria-disabled') === 'true') {
                e.preventDefault();
                btn.classList.add('animate__animated','animate__shakeX');
                setTimeout(()=>btn.classList.remove('animate__animated','animate__shakeX'), 500);
                return;
              }
              openReviewSafe(card, product);
            });
            // Ir al detalle
            const toDetail = () => { const slug = (window.romixSearch && window.romixSearch.slug) ? window.romixSearch.slug(product.name) : (String(product.name||'').toLowerCase().replace(/[^a-z0-9]+/g,'-')); window.location.href = 'product.html?slug=' + encodeURIComponent(slug); };
            const imgWrap = card.querySelector('.product-image'); if (imgWrap) { imgWrap.style.cursor='pointer'; imgWrap.addEventListener('click', toDetail); }
            const titleEl = card.querySelector('.product-title'); if (titleEl) { titleEl.addEventListener('click', toDetail); }
          });

          filterProducts('mujer', 'all');
          filterProducts('hombre', 'all');
          filterProducts('ninos', 'all');
        })
        .catch((e) => {
          console.error('Error al cargar productos:', e);
          showError('No se pudieron cargar los productos. Intentá recargar la página.');
        });
    }


    // ===== Selector Color/Talle con estados dinámicos =====
    const COLOR_HEX_FALLBACK = { negro: '#000000', violeta: '#7F00FF', fucsia: '#FF00A8', gris: '#6c757d', rojo: '#dc3545' };

    function normalizeStockByColor(product) {
      // Espera product.stockByColor = { colorName: { '1': 5, '2': 0, ... } }
      if (product && product.stockByColor) return product.stockByColor;
      // Fallback: si sólo hay product.sizes con 'status', generamos un mapa único para todos los colores
      const map = {};
      const defaultSizes = (product.sizes || []).reduce((acc, s) => {
        const status = String(s.status || '').toLowerCase();
        let qty = 5;
        if (status.includes('unavail')) qty = 0;
        else if (status.includes('low')) qty = 2;
        acc[String(s.size)] = qty;
        return acc;
      }, {});
      (product.colors || []).forEach(c => { map[c.name] = { ...defaultSizes } });
      // Si no hubiera colores definidos, creamos uno genérico
      if (!product.colors || !product.colors.length) map['único'] = { ...defaultSizes };
      return map;
    }

    function computeTotalStock(product) {
      // Prioridad: stockByColor si existe (sumando cantidades)
      if (product && product.stockByColor) {
        let total = 0;
        for (const colorName of Object.keys(product.stockByColor)) {
          const m = product.stockByColor[colorName] || {};
          for (const key of Object.keys(m)) total += Number(m[key] || 0);
        }
        return total;
      }
      // Fallback desde sizes/status
      const statuses = (product.sizes || []).map(s => String(s.status || '').toLowerCase());
      return statuses.reduce((sum, st) => {
        if (st.includes('unavail')) return sum + 0;
        if (st.includes('low')) return sum + 2;
        return sum + 5; // available u otro -> asumimos 5
      }, 0);
    }

    function stateFromStock(n) {
      if (n <= 0) return 'out';
      if (n <= 3) return 'low';
      return 'available';
    }

    function labelFromState(st) {
      if (st === 'out') return 'AGOTADO';
      if (st === 'low') return 'Por agotarse';
      return 'Disponible';
    }

    function updateSelectionStatus(card, color, size) {
      const statusEl = card.querySelector('.product-selection-status');
      if (!statusEl) return;
      if (color && size) statusEl.innerHTML = `Seleccionado: <strong>${color}</strong> – Talle: <strong>${size}</strong>`;
      else if (color) statusEl.innerHTML = `Seleccionado: <strong>${color}</strong> – Talle: <strong>Sin selección</strong>`;
      else statusEl.textContent = 'Sin selección';
    }

    function setBuyEnabled(card, enabled) {
      const btn = card.querySelector('.product-actions .btn.btn-primary');
      if (!btn) return;
      if (enabled) {
        btn.setAttribute('aria-disabled', 'false');
        btn.disabled = false;
        btn.classList.remove('animate__shakeX');
        btn.classList.add('animate__animated','animate__fadeInUp');
        setTimeout(() => btn.classList.remove('animate__animated','animate__fadeInUp'), 500);
      } else {
        btn.setAttribute('aria-disabled', 'true');
        btn.disabled = true;
      }
    }

    // ===== Precios por grupo de talles y helpers =====
    const SIZE_GROUP_PRICING = { common: 1.0, special: 1.15, superspecial: 1.15 };
    function getUnitPrice(product, size, colorName) {
      const base = Number(product.price) || 0;
      const sz = Number(size);
      if (!isNaN(sz)) {
        if (product.priceBySize && product.priceBySize[String(sz)] != null) {
          return Number(product.priceBySize[String(sz)]);
        }
        // Determinar grupo por talle (común/especial/súper especial)
        const resolveGroup = (szNum) => {
          let isSuper = false, isSpecial = false;
          if (Array.isArray(product.superSpecialSizes)) {
            isSuper = product.superSpecialSizes.map(x=>Number(x)).includes(szNum);
          } else if (product.groupSuperMin) {
            isSuper = szNum >= Number(product.groupSuperMin);
          } else {
            isSuper = szNum >= 9; // por defecto 9–10
          }
          if (!isSuper) {
            if (Array.isArray(product.specialSizes)) {
              isSpecial = product.specialSizes.map(x=>Number(x)).includes(szNum);
            } else if (product.groupSpecialMin) {
              isSpecial = szNum >= Number(product.groupSpecialMin);
            } else {
              isSpecial = szNum >= 6; // por defecto 6–8
            }
          }
          return isSuper ? 'superspecial' : (isSpecial ? 'special' : 'common');
        };
        const group = resolveGroup(sz);
        // Nota: no variamos el precio por estampa/color. Ignoramos priceByGroupByColor.
        if (product.priceByGroup && product.priceByGroup[group] != null) return Number(product.priceByGroup[group]);
        if (product.priceByGroup) {
          // Determinar si el talle pertenece al grupo especial
          let isSpecial = false;
          if (Array.isArray(product.specialSizes)) {
            isSpecial = product.specialSizes.map(x=>Number(x)).includes(sz);
          } else if (product.groupSpecialMin) {
            isSpecial = sz >= Number(product.groupSpecialMin);
          } else {
            // Regla por defecto (adultos): 6–8 especiales
            isSpecial = sz >= 6;
          }
          const group = isSpecial ? 'special' : 'common';
          if (product.priceByGroup[group] != null) return Number(product.priceByGroup[group]);
        }
        const mult = SIZE_GROUP_PRICING[group] || 1;
        return Math.round(base * mult * 100) / 100;
      }
      return base;
    }
    function getSelectedSize(card) { return card.dataset.selectedSize || (card.querySelector('.size-option.selected') || card.querySelector('.size-chip.selected'))?.dataset.size || null; }
    function updateCardPrice(card, product) {
      const size = getSelectedSize(card);
      const color = card.dataset.selectedColor || (card.querySelector('.color-option.selected')?.dataset.color) || null;
      const priceBox = card.querySelector('.product-price');
      if (!priceBox) return;
      const unit = size ? getUnitPrice(product, size, color) : Number(product.price) || 0;
      priceBox.innerHTML = `$${Number(unit).toLocaleString('es-AR')}` + (product.originalPrice ? ` <small>$${Number(product.originalPrice).toLocaleString('es-AR')}</small>` : '');
    }

    // ===== Galería por producto (simple) =====
    function initGallery(card, product) {
      const imgEl = card.querySelector('.product-image img');
      if (!imgEl) return;
      const gallery = [];
      if (product.images && typeof product.images === 'object') {
        for (const k of Object.keys(product.images)) {
          const label = (typeof fixText === 'function') ? fixText(k) : k;
          gallery.push({ color: label, src: product.images[k] });
        }
      }
      if (!gallery.length) gallery.push({ color: null, src: product.image });
      card._gallery = gallery; card._gIndex = 0;
      const wrap = card.querySelector('.product-image');
      if (!wrap) return;
      if (!card.querySelector('.gallery-prev')) {
        wrap.insertAdjacentHTML('beforeend', `
          <button class="gallery-prev" aria-label="Anterior" type="button" style="position:absolute;left:6px;top:calc(50% - 16px);background:rgba(0,0,0,.35);color:#fff;border:none;border-radius:16px;width:32px;height:32px;cursor:pointer;">‹</button>
          <button class="gallery-next" aria-label="Siguiente" type="button" style="position:absolute;right:6px;top:calc(50% - 16px);background:rgba(0,0,0,.35);color:#fff;border:none;border-radius:16px;width:32px;height:32px;cursor:pointer;">›</button>
          <div class="gallery-dots" style="position:absolute;left:0;right:0;bottom:6px;display:flex;justify-content:center;gap:6px;"></div>`);
      }
      const dots = card.querySelector('.gallery-dots');
      dots.innerHTML = gallery.map((_,i)=>`<span class="dot" data-i="${i}" style="width:8px;height:8px;border-radius:50%;background:${i===0?'#fff':'#bbb'};display:inline-block;opacity:.9;"></span>`).join('');
      const render = () => {
        const it = gallery[card._gIndex];
        imgEl.src = it?.src || product.image;
        imgEl.alt = (fixText ? fixText(product.name) : product.name) + (it?.color ? ` - ${it.color}` : '');
        dots.querySelectorAll('.dot').forEach((d, i) => d.style.background = i === card._gIndex ? '#fff' : '#bbb');
      };
      card.querySelector('.gallery-prev').onclick = () => { card._gIndex = (card._gIndex - 1 + gallery.length) % gallery.length; render(); };
      card.querySelector('.gallery-next').onclick = () => { card._gIndex = (card._gIndex + 1) % gallery.length; render(); };
      dots.querySelectorAll('.dot').forEach((d)=>{ d.addEventListener('click', ()=>{ card._gIndex = Number(d.dataset.i)||0; render(); }); });
      render();
    }

    function renderSizesForColor(card, product, colorName) {
      const sizeWrap = card.querySelector('.size-options');
      if (!sizeWrap) return;
      const stockByColor = normalizeStockByColor(product);
      const stockMap = stockByColor[colorName] || {};
      // Si el producto trae una lista explícita de talles, la usamos como orden/base.
      const allSizes = (() => {
        const raw = (product.sizes || []).map(s => String(s.size));
        const seen = new Set();
        const uniq = [];
        for (const sz of raw) { if (!seen.has(sz)) { seen.add(sz); uniq.push(sz); } }
        return uniq;
      })();
      const toRender = (allSizes.length ? allSizes : Object.keys(stockMap)).sort((a,b)=>Number(a)-Number(b));
      sizeWrap.innerHTML = toRender.map(sz => {
        const st = Number(stockMap[String(sz)] ?? 0);
        const state = stateFromStock(st);
        return `<span class="size-chip" data-state="${state}" role="button" tabindex="0" data-size="${sz}">
                  <span class="badge">${labelFromState(state)}</span>${sz}
                </span>`;
      }).join('');
      // Eventos de interacción + animación
      sizeWrap.querySelectorAll('.size-chip').forEach(el => {
        const handle = () => {
          if (el.dataset.state === 'out') return;
          sizeWrap.querySelectorAll('.size-chip').forEach(s => s.classList.remove('selected'));
          el.classList.add('selected');
          // Animación de click (rebote)
          el.classList.add('animate__animated','animate__pulse');
          setTimeout(()=> el.classList.remove('animate__animated','animate__pulse'), 500);
          const clr = card.querySelector('.color-option.selected')?.dataset.color || null;
          card.dataset.selectedSize = el.dataset.size;
          updateSelectionStatus(card, clr, el.dataset.size);
          updateCardPrice(card, product);
          setBuyEnabled(card, true);
        };
        el.addEventListener('click', handle);
        el.addEventListener('keydown', (e)=>{ if (e.key==='Enter' || e.key===' ') { e.preventDefault(); handle(); } });
      });
      // Al cambiar color, aún no hay talle elegido ⇒ deshabilitar compra
      setBuyEnabled(card, false);
      updateSelectionStatus(card, colorName, null);
      updateCardPrice(card, product);
    }

    // Sobrescribimos selectColor para que dispare render dinámico de talles y animación
    if (typeof selectColor !== 'function') { function selectColor(){} }
    const _originalSelectColor = selectColor;
    selectColor = function(el) {
      const card = el.closest('.product-card');
      // Visual
      card.querySelectorAll('.color-option').forEach((c) => c.classList.remove('selected'));
      el.classList.add('selected');
      // Animación del circulito
      el.classList.add('animate__animated','animate__rubberBand');
      setTimeout(()=> el.classList.remove('animate__animated','animate__rubberBand'), 500);

      // Buscar objeto product asociado a esta card (lo guardamos en dataset al crearla)
      const product = JSON.parse(card.dataset.product || '{}');
      const colorName = el.dataset.color;
      card.dataset.selectedColor = colorName;
      card.dataset.selectedSize = '';
      // Actualizar imagen principal según color seleccionado y sincronizar galería
      try {
        const key = colorName;
        let imgUrl = product.image;
        if (product.images) {
          imgUrl = product.images[key] || product.images[colorName] || imgUrl;
          if (imgUrl === product.image) {
            for (const k of Object.keys(product.images)) {
              if (((typeof fixText==='function')?fixText(k):k) === colorName) { imgUrl = product.images[k]; break; }
            }
          }
        }
        const imgEl = card.querySelector('.product-image img');
        if (imgEl) { imgEl.src = imgUrl; imgEl.alt = (fixText ? fixText(product.name) : product.name) + ' - ' + colorName; }
        if (card._gallery && Array.isArray(card._gallery)) {
          const idx = card._gallery.findIndex(g => (g.color === key) || (g.color === colorName));
          if (idx >= 0) {
            card._gIndex = idx;
            const dots = card.querySelector('.gallery-dots');
            if (dots) dots.querySelectorAll('.dot').forEach((d, i) => d.style.background = i === idx ? '#fff' : '#bbb');
          }
        }
      } catch {}
      renderSizesForColor(card, product, colorName);
      updateCardPrice(card, product);
    };

    // Sobrescribimos selectSize para mantener compatibilidad si hay elementos legacy .size-option
    if (typeof selectSize !== 'function') { function selectSize(){} }
    const _originalSelectSize = selectSize;
    selectSize = function(el) {
      if (el.classList.contains('unavailable') || el.getAttribute('aria-disabled') === 'true') return;
      const card = el.closest('.product-card');
      card.querySelectorAll('.size-option').forEach((s) => s.classList.remove('selected'));
      el.classList.add('selected');
      el.classList.add('animate__animated','animate__pulse');
      setTimeout(()=> el.classList.remove('animate__animated','animate__pulse'), 500);
      const colorName = card.querySelector('.color-option.selected')?.dataset.color || null;
      const size = el.dataset.size;
      updateSelectionStatus(card, colorName, size);
      try { const product = JSON.parse(card.dataset.product || '{}'); updateCardPrice(card, product); } catch {}
      setBuyEnabled(card, Boolean(colorName && !el.classList.contains('unavailable')));
    };

    function initQtyControls(card) {
      const dec = card.querySelector('.decrease');
      const inc = card.querySelector('.increase');
      const input = card.querySelector('.quantity-input');
      dec.addEventListener('click', () => { const v = parseInt(input.value) || 1; if (v > 1) input.value = v - 1; });
      inc.addEventListener('click', () => { const v = parseInt(input.value) || 1; input.value = v + 1; });
      input.addEventListener('input', () => { let v = parseInt(input.value); if (isNaN(v) || v < 1) input.value = 1; });
    }

    /* legacy */ function selectColorLegacy(el) {
      const card = el.closest('.product-card');
      card.querySelectorAll('.color-option').forEach((c) => c.classList.remove('selected'));
      el.classList.add('selected');
    }

    // (limpieza) selectSize legacy duplicado eliminado; se usa la versión mejorada más arriba

    

    function filterProducts(sectionId, type) {
      const section = document.getElementById(sectionId);
      const cards = section.querySelectorAll('.product-card');
      cards.forEach((card) => {
        const show = (type === 'all' || card.dataset.type === type);
        card.style.display = show ? 'block' : 'none';
        card.setAttribute('aria-hidden', show ? 'false' : 'true');
        if (show) { card.classList.add('animate__animated', 'animate__fadeIn'); setTimeout(() => card.classList.remove('animate__animated','animate__fadeIn'), 500); }
      });
    }

    // ===== Modal =====
    function openReview(card, product) {
      const colorEl = card.querySelector('.color-option.selected');
      const sizeEl = card.querySelector('.size-option.selected, .size-chip.selected');
      if (!colorEl || !sizeEl) { alert('Por favor, seleccioná un color y un talle antes de continuar.'); return; }

      currentType = product.type;
      const selectedColor = colorEl.dataset.color;
      const selectedSize = sizeEl.dataset.size;
      const qty = parseInt(card.querySelector('.quantity-input').value) || 1;

      const modal = document.getElementById('review-modal');
      const modalContent = modal.querySelector('.modal-content');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');

      document.getElementById('review-image').src = card.querySelector('.product-image img').getAttribute('src');
      document.getElementById('review-name').textContent = fixText(product.name);
      document.getElementById('review-type').textContent = `(${product.type})`;

      const priceEl = document.getElementById('review-price');
      const unitNow = getUnitPrice(product, selectedSize, selectedColor);
      priceEl.dataset.unitPrice = String(unitNow);
      priceEl.textContent = Number(unitNow).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      const colorSel = document.getElementById('review-color');
      colorSel.innerHTML = '';
      (product.colors || []).forEach((c) => {
        const opt = document.createElement('option');
        const cname = fixText(c.name);
        opt.value = cname; opt.textContent = cname; if (cname === selectedColor) opt.selected = true; colorSel.appendChild(opt);
      });

      const sizeSel = document.getElementById('review-size');
      sizeSel.innerHTML = '';
      (product.sizes || []).forEach((s) => {
        const opt = document.createElement('option');
        opt.value = s.size; opt.textContent = s.size + (s.status === 'unavailable' ? ' (sin stock)' : '');
        opt.disabled = s.status === 'unavailable';
        if (s.size === selectedSize) opt.selected = true;
        sizeSel.appendChild(opt);
      });
      sizeSel.onchange = () => {
        const u = getUnitPrice(product, sizeSel.value, colorSel.value);
        priceEl.dataset.unitPrice = String(u);
        priceEl.textContent = Number(u).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        updateSubtotal();
      };

      // Al cambiar el color en el modal, sincroniza imagen y precio
      colorSel.onchange = () => {
        const cname = colorSel.value;
        let imgUrl = product.image;
        if (product.images) {
          imgUrl = product.images[cname] || imgUrl;
          if (imgUrl === product.image) {
            for (const k of Object.keys(product.images)) {
              if (((typeof fixText==='function')?fixText(k):k) === cname) { imgUrl = product.images[k]; break; }
            }
          }
        }
        const img = document.getElementById('review-image');
        if (img) img.src = imgUrl;
        const u = getUnitPrice(product, sizeSel.value, cname);
        priceEl.dataset.unitPrice = String(u);
        priceEl.textContent = Number(u).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        updateSubtotal();
      };

      const qtyInput = document.getElementById('review-qty');
      const stockInfo = document.getElementById('review-stock');
      const stock = product.stock || 9999;
      stockInfo.textContent = `Stock disponible: ${stock}`;
      qtyInput.value = Math.min(qty, stock);

      const updateSubtotal = () => {
        const unit = Number(priceEl.dataset.unitPrice || '0');
        const q = Math.max(1, Math.min(parseInt(qtyInput.value) || 1, stock));
        qtyInput.value = q;
        document.getElementById('review-subtotal').textContent = (unit * q).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      };

      document.getElementById('qty-dec').onclick = () => { qtyInput.value = Math.max(1, (parseInt(qtyInput.value) || 1) - 1); updateSubtotal(); };
      document.getElementById('qty-inc').onclick = () => { qtyInput.value = Math.min(stock, (parseInt(qtyInput.value) || 1) + 1); updateSubtotal(); };
      qtyInput.oninput = updateSubtotal;

      // focus al modal
      setTimeout(() => modalContent.focus(), 0);
      updateSubtotal();
    }

    // Versión robusta: usa dataset seleccionado y recalcula precio según talle
    function openReviewSafe(card, product) {
      const selectedColor = card.dataset.selectedColor || card.querySelector('.color-option.selected')?.dataset.color || null;
      const selectedSize = card.dataset.selectedSize || card.querySelector('.size-option.selected, .size-chip.selected')?.dataset.size || null;
      if (!selectedColor || !selectedSize) { alert('Por favor, seleccioná un color y un talle antes de continuar.'); return; }

      currentType = product.type;
      const qty = parseInt(card.querySelector('.quantity-input').value) || 1;

      const modal = document.getElementById('review-modal');
      const modalContent = modal.querySelector('.modal-content');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');

      document.getElementById('review-image').src = card.querySelector('.product-image img').getAttribute('src');
      document.getElementById('review-name').textContent = fixText(product.name);
      document.getElementById('review-type').textContent = `(${product.type})`;

      const priceEl = document.getElementById('review-price');
      const unitNow = getUnitPrice(product, selectedSize);
      priceEl.dataset.unitPrice = String(unitNow);
      priceEl.textContent = Number(unitNow).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      const colorSel = document.getElementById('review-color');
      colorSel.innerHTML = '';
      (product.colors || []).forEach((c) => {
        const opt = document.createElement('option');
        const cname = fixText(c.name);
        opt.value = cname; opt.textContent = cname; if (cname === selectedColor) opt.selected = true; colorSel.appendChild(opt);
      });

      const sizeSel = document.getElementById('review-size');
      sizeSel.innerHTML = '';
      (product.sizes || []).forEach((s) => {
        const opt = document.createElement('option');
        opt.value = s.size; opt.textContent = s.size + (s.status === 'unavailable' ? ' (sin stock)' : '');
        opt.disabled = s.status === 'unavailable';
        if (s.size === selectedSize) opt.selected = true;
        sizeSel.appendChild(opt);
      });
      sizeSel.onchange = () => {
        const u = getUnitPrice(product, sizeSel.value, colorSel.value);
        priceEl.dataset.unitPrice = String(u);
        priceEl.textContent = Number(u).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        updateSubtotal();
      };

      // Cambiar color en modal (safe)
      colorSel.onchange = () => {
        const cname = colorSel.value;
        let imgUrl = product.image;
        if (product.images) {
          imgUrl = product.images[cname] || imgUrl;
          if (imgUrl === product.image) {
            for (const k of Object.keys(product.images)) {
              if (((typeof fixText==='function')?fixText(k):k) === cname) { imgUrl = product.images[k]; break; }
            }
          }
        }
        const img = document.getElementById('review-image');
        if (img) img.src = imgUrl;
        const u = getUnitPrice(product, sizeSel.value, cname);
        priceEl.dataset.unitPrice = String(u);
        priceEl.textContent = Number(u).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        updateSubtotal();
      };

      const qtyInput = document.getElementById('review-qty');
      const stockInfo = document.getElementById('review-stock');
      const stock = product.stock || 9999;
      stockInfo.textContent = `Stock disponible: ${stock}`;
      qtyInput.value = Math.min(qty, stock);

      const updateSubtotal = () => {
        const unit = Number(priceEl.dataset.unitPrice || '0');
        const q = Math.max(1, Math.min(parseInt(qtyInput.value) || 1, stock));
        qtyInput.value = q;
        document.getElementById('review-subtotal').textContent = (unit * q).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      };

      document.getElementById('qty-dec').onclick = () => { qtyInput.value = Math.max(1, (parseInt(qtyInput.value) || 1) - 1); updateSubtotal(); };
      document.getElementById('qty-inc').onclick = () => { qtyInput.value = Math.min(stock, (parseInt(qtyInput.value) || 1) + 1); updateSubtotal(); };
      qtyInput.oninput = updateSubtotal;

      setTimeout(() => modalContent.focus(), 0);
      updateSubtotal();
    }

    function closeReviewModal() {
      const modal = document.getElementById('review-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }

    function confirmReviewToCart() {
      const name = document.getElementById('review-name').textContent;
      const color = document.getElementById('review-color').value;
      const size = document.getElementById('review-size').value;
      const qty = parseInt(document.getElementById('review-qty').value) || 1;
      const unit = Number(document.getElementById('review-price').dataset.unitPrice || '0');
      const subtotal = unit * qty;
      const item = { id: Date.now(), name, type: currentType, color, size, quantity: qty, price: unit, subtotal };
      cart.push(item);
      safeSetCart(cart);
      updateCart();
      closeReviewModal();
      alert('¡Listo! Se agregó al carrito.');
    }

    
    // ===== Test básico (activar con ?test=1) =====
    (function runBasicTests(){
      if (!/[?&]test=1\b/.test(location.search)) return;
      const log = (...a)=>console.log('[TEST]', ...a);
      const mujerCard = document.querySelector('#mujer-grid .product-card');
      if (!mujerCard) { log('No hay cards para probar'); return; }
      const firstColor = mujerCard.querySelector('.color-option');
      if (!firstColor) { log('No hay colores'); return; }
      firstColor.click();
      const anySize = mujerCard.querySelector('.size-chip[data-state="available"], .size-option:not(.unavailable)');
      if (!anySize) { log('No hay talles disponibles'); return; }
      anySize.click();
      const status = mujerCard.querySelector('.product-selection-status')?.textContent || '';
      const btn = mujerCard.querySelector('.btn.btn-primary');
      log('Estado de selección:', status);
      log('Botón habilitado:', btn.getAttribute('aria-disabled') === 'false');
      const stockTxt = mujerCard.querySelector('.product-stock-note')?.textContent;
      log('Nota de stock:', stockTxt);
    })();

    // ===== Carrito =====
    function removeFromCart(id) {
      cart = cart.filter((it) => it.id !== id);
      safeSetCart(cart);
      updateCart();
    }

    function clearCart() {
      cart = [];
      safeSetCart(cart);
      updateCart();
    }

    function updateCart() {
      const body = document.getElementById('cart-items');
      const totalEl = document.getElementById('cart-total');
      const countEl = document.getElementById('cart-count');
      if (!body || !totalEl || !countEl) return;
      body.innerHTML = '';
      let total = 0, count = 0;
      cart.forEach((item) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.type}</td>
          <td>${item.color}</td>
          <td>${item.size}</td>
          <td>${item.quantity}</td>
          <td>$${item.price.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>$${item.subtotal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td><button class="btn btn-danger" type="button" aria-label="Eliminar del carrito" onclick="removeFromCart(${item.id})"><i class="fas fa-trash" aria-hidden="true"></i></button></td>`;
        body.appendChild(tr);
        total += item.subtotal; count += item.quantity;
      });
      totalEl.textContent = total.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      countEl.textContent = String(count);

      const cartSection = document.getElementById('cart');
      const cartBtn = document.querySelector('.cart-icon-btn');
      if (cart.length === 0) {
        cartSection.classList.add('hidden');
        cartBtn && cartBtn.setAttribute('aria-expanded', 'false');
      } else {
        cartSection.classList.remove('hidden');
      }
    }

    function toggleCart() {
      const sec = document.getElementById('cart');
      if (!sec) return;
      const toHidden = !sec.classList.contains('hidden');
      sec.classList.toggle('hidden');
      const btn = document.querySelector('.cart-icon-btn');
      btn && btn.setAttribute('aria-expanded', String(!toHidden));
      if (!sec.classList.contains('hidden')) {
        sec.classList.add('animate__animated', 'animate__fadeIn');
        setTimeout(() => sec.classList.remove('animate__animated', 'animate__fadeIn'), 800);
      }
    }

    function sendToWhatsApp() {
      if (!cart.length) { alert('El carrito está vacío.'); return; }
      let message = '¡Hola! Quiero realizar el siguiente pedido:\n\n';
      cart.forEach((item) => {
        message += `${item.name} (${item.type})\n`;
        message += `Color: ${item.color}\n`;
        message += `Talle: ${item.size}\n`;
        message += `Cantidad: ${item.quantity}\n`;
        message += `Subtotal: $${item.subtotal.toFixed(2)}\n\n`;
      });
      message += `Total: $${cart.reduce((t, i) => t + i.subtotal, 0).toFixed(2)}`;
      const encoded = encodeURIComponent(message);
      const phone = '+5491154272065';
      const w = window.open(`https://wa.me/${phone}?text=${encoded}`, '_blank');
      if (w) w.opener = null;
    }
  </script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const tryLoad = () => {
    const anyCard = document.querySelector('.product-card');
    if (anyCard) return;
    // Attempt to fetch products.json and call loadProducts if available
    if (typeof loadProducts === 'function') {
      fetch('products.json').then(r=>r.json()).then(data=>{
        try { loadProducts(data); } catch (e) { console.error('[ROMIX] loadProducts retry failed:', e); }
      }).catch(err=>console.error('[ROMIX] watchdog fetch failed:', err));
    }
  };
  setTimeout(tryLoad, 400);
});
</script>
<script>
// ====== Global filter bar logic ======
function normalize(s){ try { return String(s||'').normalize('NFD').replace(/\p{Diacritic}+/gu,'').toLowerCase(); } catch { return String(s||'').toLowerCase(); } }
function initGlobalFilters(){
  const qInput = document.getElementById('filter-q');
  const toggle = document.getElementById('filter-toggle');
  const body = document.getElementById('filter-body');
  const chips = document.querySelectorAll('#filter-types input[type="checkbox"]');
  const sectionSel = document.getElementById('filter-section');
  const priceMin = document.getElementById('filter-price-min');
  const priceMax = document.getElementById('filter-price-max');
  const availabilitySel = document.getElementById('filter-availability');
  if (!qInput || !toggle || !body) return;
  let debounce;
  const apply = ()=>{ clearTimeout(debounce); debounce = setTimeout(applyGlobalFilters, 60); };
  qInput.addEventListener('input', apply);
  chips.forEach(c=>c.addEventListener('change', apply));
  sectionSel && sectionSel.addEventListener('change', apply);
  priceMin && priceMin.addEventListener('input', apply);
  priceMax && priceMax.addEventListener('input', apply);
  availabilitySel && availabilitySel.addEventListener('change', apply);
  const applyBtn = document.getElementById('filter-apply');
  applyBtn && applyBtn.addEventListener('click', apply);
  toggle.addEventListener('click', ()=>{ const hidden = body.classList.toggle('hidden'); body.setAttribute('aria-hidden', String(hidden)); toggle.querySelector('span').textContent = hidden ? 'Mostrar filtros' : 'Ocultar filtros'; });
}
function applyGlobalFilters(){
  const q = normalize(document.getElementById('filter-q')?.value || '');
  const selTypes = Array.from(document.querySelectorAll('#filter-types input[type="checkbox"]:checked')).map(el=>normalize(el.value));
  const sectionVal = (document.getElementById('filter-section')?.value || 'all').toLowerCase();
  const minPrice = Number(document.getElementById('filter-price-min')?.value || '0');
  const maxPrice = Number(document.getElementById('filter-price-max')?.value || '999999');
  const availVal = (document.getElementById('filter-availability')?.value || 'all').toLowerCase();
  const cards = document.querySelectorAll('.product-card');
  let shown = 0;
  cards.forEach(card=>{
    let ok = true;
    try {
      const prod = JSON.parse(card.dataset.product || '{}');
      const name = normalize(prod.name || '');
      const type = normalize(prod.type || '');
      const section = normalize(prod.section || '');
      const price = Number(prod.price) || 0;
      const total = computeTotalStock(prod);
      const state = stateFromStock(total);
      if (q && !name.includes(q)) ok = false;
      if (ok && selTypes.length && !selTypes.includes(type)) ok = false;
      if (ok && sectionVal !== 'all' && section !== sectionVal) ok = false;
      if (ok && (price < minPrice || price > maxPrice)) ok = false;
      if (ok && availVal !== 'all' && state !== availVal) ok = false;
    } catch {}
    card.style.display = ok ? 'block' : 'none';
    if (ok) shown++;
  });
  const empty = document.getElementById('no-results');
  if (empty) empty.classList.toggle('hidden', shown>0);
}
document.addEventListener('DOMContentLoaded', ()=>{ initGlobalFilters(); });
</script>
<script src="support-widget-romix.js" defer></script>
<script src="search.js"></script>
</body>
</html>

</html>




