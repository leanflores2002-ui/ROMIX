<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Romix - Colección Invierno 2025</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-SnMh5Zq9wTW8QLm2k7w3z2wQz0s0nKxHq4xFf9m4V3LQ8v7V4n9H2m3Wn7g0qUQy9VwQ1p4f8U8tH1hJ0nqQwQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" integrity="sha512-b7ZPnUPQK1G3z2d4l0f7Gm2M1eJp4z8f5s1p9o3r2x6z0kYd8l9r4Qv5B1c2D3E4F5G6H7I8J9K0L1M2N3O4PQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --primary: #e83e8c; --secondary: #6f42c1; --light: #f8f9fa; --dark: #343a40;
      --success: #28a745; --danger: #dc3545; --warning: #ffc107;
      --radius: 10px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f5f5f5; color: #333; }
    header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; padding: 20px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,.1); }
    .header-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .contact-header { display: flex; align-items: center; gap: 10px; }
    .whatsapp-header { background-color: #25D366; color: #fff; padding: 8px 15px; border-radius: 20px; text-decoration: none; display: inline-flex; align-items: center; font-weight: 700; gap: 6px; }
    .cart-icon-btn { position: relative; display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 8px 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,.4); background: rgba(0,0,0,.1); color: #fff; cursor: pointer; }
    .cart-icon-btn:focus-visible { outline: 3px solid #fff; outline-offset: 2px; }
    #cart-count { background: var(--danger); color: #fff; border-radius: 999px; padding: 0 6px; font-size: .8rem; position: absolute; top: -8px; right: -8px; min-width: 18px; text-align: center; }

    nav { background: #fff; position: sticky; top: 72px; z-index: 999; box-shadow: 0 2px 5px rgba(0,0,0,.1); }
    .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .nav-menu { display: flex; list-style: none; overflow-x: auto; white-space: nowrap; }
    .nav-menu li a { display: block; padding: 15px 20px; color: var(--dark); text-decoration: none; font-weight: 600; transition: .3s; }
    .nav-menu li a:hover, .nav-menu li.active a { color: var(--primary); }

    .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    .section-title { font-size: 1.8rem; color: var(--secondary); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; display: flex; align-items: center; gap: 10px; }

    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .product-card { background: #fff; border-radius: var(--radius); overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,.1); transition: transform .3s, box-shadow .3s; position: relative; }
    .product-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,.15); }
    .product-image { height: 200px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; position: relative; }
    .product-image img { max-width: 80%; max-height: 80%; object-fit: contain; }
    .product-badge { position: absolute; top: 10px; right: 10px; background: var(--primary); color: #fff; padding: 5px 10px; border-radius: 20px; font-size: .8rem; font-weight: 700; }
    .product-info { padding: 15px; }
    .product-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; color: var(--dark); height: 50px; overflow: hidden; }
    .product-price { font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 10px; }
    .product-price small { font-size: .9rem; color: #6c757d; text-decoration: line-through; margin-left: 5px; }

    .product-colors, .size-options { display: flex; flex-wrap: wrap; gap: 6px; }
    .color-option { width: 22px; height: 22px; border-radius: 50%; border: 1px solid #ddd; cursor: pointer; outline: none; }
    .color-option.selected { box-shadow: 0 0 0 2px var(--primary); }
    .size-option { padding: 5px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: .85rem; cursor: pointer; }
    .size-option:hover { border-color: var(--primary); }
    .size-option.selected { border: 2px solid var(--primary); }
    .size-option.unavailable { background: #f8f9fa; color: #6c757d; text-decoration: line-through; cursor: not-allowed; }

    .quantity-control { display: flex; align-items: center; gap: 6px; margin: 10px 0; }
    .quantity-title { font-size: .9rem; color: #6c757d; }
    .quantity-btn { padding: 6px 10px; font-size: .9rem; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 6px; }
    .quantity-input { width: 56px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }

    .product-actions { display: flex; gap: 10px; }
    .btn { padding: 8px 15px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-danger { background: var(--danger); color: #fff; }

    .contact-section, .cart-section { background: #fff; border-radius: var(--radius); padding: 30px; margin-top: 40px; box-shadow: 0 3px 10px rgba(0,0,0,.1); }
    .cart-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .cart-table th, .cart-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    .cart-table th { background: var(--light); font-weight: 700; color: var(--secondary); }
    .cart-total { margin-top: 20px; font-size: 1.3rem; font-weight: 700; text-align: right; color: var(--primary); }
    .cart-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 2000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: var(--radius); width: 95%; max-width: 520px; box-shadow: 0 5px 15px rgba(0,0,0,.3); }
    .modal-content h3 { margin-bottom: 15px; color: var(--secondary); }
    .modal-row { display: grid; grid-template-columns: 120px 1fr; gap: 15px; align-items: start; }
    .modal-thumb { width: 120px; height: 120px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .summary { background: #fafafa; border: 1px solid #eee; border-radius: 8px; padding: 12px; margin-top: 10px; font-size: .95rem; }
    .price-line { display: flex; justify-content: space-between; margin-top: 8px; }
    .modal-content label { display: block; margin: 12px 0 6px; font-weight: 700; }
    .modal-content select, .modal-content input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
    .modal-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .hidden { display: none; }

    footer { background: var(--dark); color: #fff; padding: 30px 0; margin-top: 50px; }
    .footer-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 30px; }
    .footer-column h4 { font-size: 1.2rem; margin-bottom: 15px; color: var(--primary); }
    .footer-column ul { list-style: none; }
    .footer-column ul li { margin-bottom: 10px; }
    .footer-column ul li a { color: #adb5bd; text-decoration: none; transition: color .3s; }
    .footer-column ul li a:hover { color: #fff; }
    .social-links { display: flex; gap: 15px; margin-top: 15px; }
    .social-links a { color: #fff; background: #495057; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color .3s; }
    .social-links a:hover { background: var(--primary); }
    .copyright { text-align: center; padding-top: 20px; margin-top: 20px; border-top: 1px solid #495057; color: #adb5bd; font-size: .9rem; }

    @media (max-width:768px) {
      .header-container { flex-direction: column; text-align: center; gap: 10px; }
      .products-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
      .cart-table { font-size: .85rem; }
      .modal-row { grid-template-columns: 1fr; }
      .modal-thumb { width: 100%; height: 180px; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#mujer" style="position:absolute;left:-9999px;top:auto;">Saltar al contenido</a>
  <header>
    <div class="header-container">
      <div class="logo" aria-label="Romix"><i class="fas fa-tshirt" aria-hidden="true"></i><span>ROMIX</span></div>
      <div class="contact-header">
        <a href="https://wa.me/5491154272065" class="whatsapp-header" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp Romix"><i class="fab fa-whatsapp" aria-hidden="true"></i> +54 9 11 5427-2065</a>
        <button type="button" class="cart-icon-btn" onclick="toggleCart()" aria-haspopup="region" aria-controls="cart" aria-expanded="false">
          <i class="fas fa-shopping-cart" aria-hidden="true"></i>
          <span>Carrito</span>
          <span id="cart-count" aria-live="polite">0</span>
        </button>
      </div>
    </div>
  </header>

  <nav aria-label="Principal">
    <div class="nav-container">
      <ul class="nav-menu">
        <li class="active"><a href="#mujer"><i class="fas fa-female" aria-hidden="true"></i> Mujer</a></li>
        <li><a href="#hombre"><i class="fas fa-male" aria-hidden="true"></i> Hombre</a></li>
        <li><a href="#ninos"><i class="fas fa-child" aria-hidden="true"></i> Niños</a></li>
        <li><a href="#contacto"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Contacto</a></li>
        <li><a href="#" onclick="redirectToHelp();return false;"><i class="fas fa-question-circle" aria-hidden="true"></i> Ayuda</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div id="feedback" class="hidden" role="status" aria-live="polite" style="margin-bottom:10px;color:#c00;"></div>

    <section id="cart" class="cart-section hidden" role="region" aria-label="Carrito de compras">
      <h2 class="section-title"><i class="fas fa-shopping-cart" aria-hidden="true"></i> Carrito de Compras</h2>
      <table class="cart-table">
        <thead>
          <tr>
            <th>Producto</th><th>Tipo</th><th>Color</th><th>Talle</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cart-items"></tbody>
      </table>
      <div class="cart-total">Total: $<span id="cart-total">0</span></div>
      <div class="cart-actions">
        <button class="btn btn-danger" type="button" onclick="clearCart()"><i class="fas fa-trash" aria-hidden="true"></i> Vaciar Carrito</button>
        <button class="btn btn-success" type="button" onclick="sendToWhatsApp()"><i class="fab fa-whatsapp" aria-hidden="true"></i> Enviar Pedido</button>
      </div>
    </section>

    <section id="mujer">
      <h2 class="section-title"><i class="fas fa-female" aria-hidden="true"></i> Ropa para Mujer</h2>
      <div class="filters">
        <label class="visually-hidden" for="filter-mujer">Filtrar Mujer</label>
        <select id="filter-mujer" onchange="filterProducts('mujer', this.value)">
          <option value="all">Todos</option>
          <option value="calzas">Calzas</option>
          <option value="pantalones">Pantalones</option>
          <option value="camperas">Camperas</option>
          <option value="buzos">Buzos</option>
        </select>
      </div>
      <div class="products-grid" id="mujer-grid"></div>
    </section>

    <section id="hombre">
      <h2 class="section-title"><i class="fas fa-male" aria-hidden="true"></i> Ropa para Hombre</h2>
      <div class="filters">
        <label class="visually-hidden" for="filter-hombre">Filtrar Hombre</label>
        <select id="filter-hombre" onchange="filterProducts('hombre', this.value)">
          <option value="all">Todos</option>
          <option value="pantalones">Pantalones</option>
          <option value="camperas">Camperas</option>
          <option value="buzos">Buzos</option>
          <option value="camisetas">Camisetas</option>
        </select>
      </div>
      <div class="products-grid" id="hombre-grid"></div>
    </section>

    <section id="ninos">
      <h2 class="section-title"><i class="fas fa-child" aria-hidden="true"></i> Ropa para Niños</h2>
      <div class="filters">
        <label class="visually-hidden" for="filter-ninos">Filtrar Niños</label>
        <select id="filter-ninos" onchange="filterProducts('ninos', this.value)">
          <option value="all">Todos</option>
          <option value="buzos">Buzos</option>
          <option value="pantalones">Pantalones</option>
          <option value="calzas">Calzas</option>
          <option value="camisetas">Camisetas</option>
          <option value="camperas">Camperas</option>
        </select>
      </div>
      <div class="products-grid" id="ninos-grid"></div>
    </section>

    <section id="contacto" class="contact-section">
      <h2 class="section-title"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Contacto y Ubicación</h2>
      <div class="contact-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;">
        <div class="contact-info">
          <h3>Información de contacto</h3>
          <p><i class="fas fa-store" aria-hidden="true"></i> <strong>Tienda física:</strong> Concordia 514 local b, CABA</p>
          <p><i class="fas fa-phone" aria-hidden="true"></i> <strong>Teléfono:</strong> <a href="tel:+5491154272065">+54 9 11 5427-2065</a></p>
          <p><i class="fab fa-whatsapp" aria-hidden="true"></i> <strong>WhatsApp:</strong> <a href="https://wa.me/5491154272065" target="_blank" rel="noopener noreferrer">+54 9 11 5427-2065</a></p>
          <p><i class="fas fa-envelope" aria-hidden="true"></i> <strong>Email:</strong> <a href="mailto:info@romix.com.ar">info@romix.com.ar</a></p>
          <div class="business-hours">
            <h3>Horarios de atención</h3>
            <ul>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Lunes a Viernes</span> <span>7:00 - 16:30 hs</span></li>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Sábados</span> <span>7:00 - 12:30 hs</span></li>
              <li style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Domingos</span> <span>Cerrado</span></li>
            </ul>
          </div>
        </div>
        <div class="contact-info">
          <h3>Formas de Pago</h3>
          <p><i class="fas fa-money-bill-wave" aria-hidden="true"></i> Efectivo, Transferencia, Mercado Pago</p>
          <h3 style="margin-top: 20px;">Seguinos en redes</h3>
        </div>
      </div>
    </section>
  </div>

  <!-- MODAL -->
  <div id="review-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="review-title" aria-hidden="true">
    <div class="modal-content animate__animated animate__fadeIn" tabindex="-1">
      <h3 id="review-title">Revisar pedido</h3>
      <div class="modal-row">
        <div class="modal-thumb"><img id="review-image" alt="Producto seleccionado" /></div>
        <div>
          <div class="summary">
            <p><strong id="review-name">Producto</strong> <span id="review-type" style="color:#6c757d"></span></p>
            <div class="price-line"><span>Precio unitario</span><strong>$<span id="review-price" data-unit-price="0">0</span></strong></div>
            <div class="price-line"><span>Subtotal</span><strong>$<span id="review-subtotal">0</span></strong></div>
            <p id="review-stock" style="margin-top:6px;color:#6c757d;">Stock disponible: -</p>
          </div>

          <label for="review-color">Color</label>
          <select id="review-color"></select>

          <label for="review-size">Talle</label>
          <select id="review-size"></select>

          <label for="review-qty">Cantidad</label>
          <div class="quantity-control" style="margin-top:4px;">
            <button class="btn quantity-btn" id="qty-dec" type="button" aria-label="Disminuir cantidad">−</button>
            <input type="number" id="review-qty" class="quantity-input" min="1" value="1" />
            <button class="btn quantity-btn" id="qty-inc" type="button" aria-label="Aumentar cantidad">+</button>
          </div>

          <div class="modal-actions">
            <button class="btn btn-outline" type="button" onclick="closeReviewModal()">Cancelar</button>
            <button class="btn btn-primary" type="button" onclick="confirmReviewToCart()"><i class="fas fa-check" aria-hidden="true"></i> Confirmar compra</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-container">
      <div class="footer-column">
        <h4>Productos</h4>
        <ul>
          <li><a href="#mujer">Ropa para Mujer</a></li>
          <li><a href="#hombre">Ropa para Hombre</a></li>
          <li><a href="#ninos">Ropa para Niños</a></li>
          <li><a href="#">Novedades</a></li>
          <li><a href="#">Ofertas</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Ayuda</h4>
        <ul>
          <li><a href="#">Guía de talles</a></li>
          <li><a href="#">Cambios</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Contacto</h4>
        <ul>
          <li><a href="#contacto">Dirección y horarios</a></li>
          <li><a href="https://wa.me/5491154272065" target="_blank" rel="noopener noreferrer">WhatsApp</a></li>
          <li><a href="tel:+5491154272065">Llamar por teléfono</a></li>
          <li><a href="mailto:info@romix.com.ar">Enviar email</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright"><p>&copy; 2025 Romix - Todos los derechos reservados</p></div>
  </footer>

  <script>
    // ===== Estado seguro de localStorage =====
    function safeGetCart() {
      try { return JSON.parse(localStorage.getItem('cart')) || []; } catch { return []; }
    }
    function safeSetCart(value) {
      try { localStorage.setItem('cart', JSON.stringify(value)); } catch {}
    }

    let cart = safeGetCart();
    let currentType = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      updateCart();
      // Cerrar modal con ESC y clic fuera
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeReviewModal(); });
      document.getElementById('review-modal').addEventListener('click', (e) => {
        if (e.target.id === 'review-modal') closeReviewModal();
      });
    });

    function showError(msg) {
      const fb = document.getElementById('feedback');
      fb.textContent = msg; fb.classList.remove('hidden');
      setTimeout(() => fb.classList.add('hidden'), 4000);
    }

    function loadProducts() {
      return fetch('products.json')
        .then((r) => r.json())
        .then((products) => {
          const sections = {
            mujer: document.getElementById('mujer-grid'),
            hombre: document.getElementById('hombre-grid'),
            ninos: document.getElementById('ninos-grid')
          };

          products.forEach((product) => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.type = product.type;

            let priceHTML = `$${Number(product.price).toLocaleString('es-AR')}`;
            if (product.originalPrice) {
              priceHTML += ` <small>$${Number(product.originalPrice).toLocaleString('es-AR')}</small>`;
            }
            const badgeHTML = product.badge ? `<span class="product-badge">${product.badge}</span>` : '';

            const colorsHTML = (product.colors || []).map((color) => {
              const border = color.hex === '#ffffff' ? 'border:1px solid #ddd;' : '';
              return `<div class="color-option" role="button" tabindex="0" aria-label="Color ${color.name}" style="background-color:${color.hex};${border}" title="${color.name}" data-color="${color.name}"></div>`;
            }).join('');

            const sizesHTML = (product.sizes || []).map((s) => {
              const unavailable = s.status === 'unavailable';
              return `<span class="size-option ${s.status}" role="button" ${unavailable ? 'aria-disabled="true"' : ''} tabindex="0" data-size="${s.size}">${s.size}</span>`;
            }).join('');

            card.innerHTML = `
              <div class="product-image">
                <img src="${product.image}" alt="${product.name}" loading="lazy" />
                ${badgeHTML}
              </div>
              <div class="product-info">
                <h3 class="product-title">${product.name}</h3>
                <div class="product-price">${priceHTML}</div>
                <div class="product-colors">${colorsHTML}</div>
                <div class="product-sizes">
                  <div class="size-title">Talles disponibles:</div>
                  <div class="size-options">${sizesHTML}</div>
                </div>
                <div class="quantity-control">
                  <span class="quantity-title">Cantidad:</span>
                  <button class="btn quantity-btn decrease" type="button" aria-label="Disminuir cantidad">-</button>
                  <input type="number" class="quantity-input" min="1" value="1" inputmode="numeric" />
                  <button class="btn quantity-btn increase" type="button" aria-label="Aumentar cantidad">+</button>
                </div>
                <div class="product-actions">
                  <button class="btn btn-primary" type="button">Comprar</button>
                </div>
              </div>`;

            sections[product.section].appendChild(card);

            // Eventos
            card.querySelectorAll('.color-option').forEach((el) => {
              el.addEventListener('click', () => selectColor(el));
              el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectColor(el); } });
            });
            card.querySelectorAll('.size-option').forEach((el) => {
              el.addEventListener('click', () => selectSize(el));
              el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectSize(el); } });
            });
            initQtyControls(card);
            card.querySelector('.btn.btn-primary').addEventListener('click', () => openReview(card, product));
          });

          filterProducts('mujer', 'all');
          filterProducts('hombre', 'all');
          filterProducts('ninos', 'all');
        })
        .catch((e) => {
          console.error('Error al cargar productos:', e);
          showError('No se pudieron cargar los productos. Intentá recargar la página.');
        });
    }

    function initQtyControls(card) {
      const dec = card.querySelector('.decrease');
      const inc = card.querySelector('.increase');
      const input = card.querySelector('.quantity-input');
      dec.addEventListener('click', () => { const v = parseInt(input.value) || 1; if (v > 1) input.value = v - 1; });
      inc.addEventListener('click', () => { const v = parseInt(input.value) || 1; input.value = v + 1; });
      input.addEventListener('input', () => { let v = parseInt(input.value); if (isNaN(v) || v < 1) input.value = 1; });
    }

    function selectColor(el) {
      const card = el.closest('.product-card');
      card.querySelectorAll('.color-option').forEach((c) => c.classList.remove('selected'));
      el.classList.add('selected');
    }

    function selectSize(el) {
      if (el.classList.contains('unavailable') || el.getAttribute('aria-disabled') === 'true') return; // no permitir
      const card = el.closest('.product-card');
      card.querySelectorAll('.size-option').forEach((s) => s.classList.remove('selected'));
      el.classList.add('selected');
    }

    function redirectToHelp() { window.location.href = 'ayuda.html'; }

    function filterProducts(sectionId, type) {
      const section = document.getElementById(sectionId);
      const cards = section.querySelectorAll('.product-card');
      cards.forEach((card) => {
        const show = (type === 'all' || card.dataset.type === type);
        card.style.display = show ? 'block' : 'none';
        card.setAttribute('aria-hidden', show ? 'false' : 'true');
        if (show) { card.classList.add('animate__animated', 'animate__fadeIn'); setTimeout(() => card.classList.remove('animate__animated','animate__fadeIn'), 500); }
      });
    }

    // ===== Modal =====
    function openReview(card, product) {
      const colorEl = card.querySelector('.color-option.selected');
      const sizeEl = card.querySelector('.size-option.selected');
      if (!colorEl || !sizeEl) { alert('Por favor, seleccioná un color y un talle antes de continuar.'); return; }

      currentType = product.type;
      const selectedColor = colorEl.dataset.color;
      const selectedSize = sizeEl.dataset.size;
      const qty = parseInt(card.querySelector('.quantity-input').value) || 1;

      const modal = document.getElementById('review-modal');
      const modalContent = modal.querySelector('.modal-content');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');

      document.getElementById('review-image').src = card.querySelector('.product-image img').getAttribute('src');
      document.getElementById('review-name').textContent = product.name;
      document.getElementById('review-type').textContent = `(${product.type})`;

      const priceEl = document.getElementById('review-price');
      priceEl.dataset.unitPrice = String(Number(product.price));
      priceEl.textContent = Number(product.price).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      const colorSel = document.getElementById('review-color');
      colorSel.innerHTML = '';
      (product.colors || []).forEach((c) => {
        const opt = document.createElement('option');
        opt.value = c.name; opt.textContent = c.name; if (c.name === selectedColor) opt.selected = true; colorSel.appendChild(opt);
      });

      const sizeSel = document.getElementById('review-size');
      sizeSel.innerHTML = '';
      (product.sizes || []).forEach((s) => {
        const opt = document.createElement('option');
        opt.value = s.size; opt.textContent = s.size + (s.status === 'unavailable' ? ' (sin stock)' : '');
        opt.disabled = s.status === 'unavailable';
        if (s.size === selectedSize) opt.selected = true;
        sizeSel.appendChild(opt);
      });

      const qtyInput = document.getElementById('review-qty');
      const stockInfo = document.getElementById('review-stock');
      const stock = product.stock || 9999;
      stockInfo.textContent = `Stock disponible: ${stock}`;
      qtyInput.value = Math.min(qty, stock);

      const updateSubtotal = () => {
        const unit = Number(priceEl.dataset.unitPrice || '0');
        const q = Math.max(1, Math.min(parseInt(qtyInput.value) || 1, stock));
        qtyInput.value = q;
        document.getElementById('review-subtotal').textContent = (unit * q).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      };

      document.getElementById('qty-dec').onclick = () => { qtyInput.value = Math.max(1, (parseInt(qtyInput.value) || 1) - 1); updateSubtotal(); };
      document.getElementById('qty-inc').onclick = () => { qtyInput.value = Math.min(stock, (parseInt(qtyInput.value) || 1) + 1); updateSubtotal(); };
      qtyInput.oninput = updateSubtotal;

      // focus al modal
      setTimeout(() => modalContent.focus(), 0);
      updateSubtotal();
    }

    function closeReviewModal() {
      const modal = document.getElementById('review-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }

    function confirmReviewToCart() {
      const name = document.getElementById('review-name').textContent;
      const color = document.getElementById('review-color').value;
      const size = document.getElementById('review-size').value;
      const qty = parseInt(document.getElementById('review-qty').value) || 1;
      const unit = Number(document.getElementById('review-price').dataset.unitPrice || '0');
      const subtotal = unit * qty;
      const item = { id: Date.now(), name, type: currentType, color, size, quantity: qty, price: unit, subtotal };
      cart.push(item);
      safeSetCart(cart);
      updateCart();
      closeReviewModal();
      alert('¡Listo! Se agregó al carrito.');
    }

    // ===== Carrito =====
    function removeFromCart(id) {
      cart = cart.filter((it) => it.id !== id);
      safeSetCart(cart);
      updateCart();
    }

    function clearCart() {
      cart = [];
      safeSetCart(cart);
      updateCart();
    }

    function updateCart() {
      const body = document.getElementById('cart-items');
      const totalEl = document.getElementById('cart-total');
      const countEl = document.getElementById('cart-count');
      if (!body || !totalEl || !countEl) return;
      body.innerHTML = '';
      let total = 0, count = 0;
      cart.forEach((item) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.type}</td>
          <td>${item.color}</td>
          <td>${item.size}</td>
          <td>${item.quantity}</td>
          <td>$${item.price.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>$${item.subtotal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td><button class="btn btn-danger" type="button" aria-label="Eliminar del carrito" onclick="removeFromCart(${item.id})"><i class="fas fa-trash" aria-hidden="true"></i></button></td>`;
        body.appendChild(tr);
        total += item.subtotal; count += item.quantity;
      });
      totalEl.textContent = total.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      countEl.textContent = String(count);

      const cartSection = document.getElementById('cart');
      const cartBtn = document.querySelector('.cart-icon-btn');
      if (cart.length === 0) {
        cartSection.classList.add('hidden');
        cartBtn && cartBtn.setAttribute('aria-expanded', 'false');
      } else {
        cartSection.classList.remove('hidden');
      }
    }

    function toggleCart() {
      const sec = document.getElementById('cart');
      if (!sec) return;
      const toHidden = !sec.classList.contains('hidden');
      sec.classList.toggle('hidden');
      const btn = document.querySelector('.cart-icon-btn');
      btn && btn.setAttribute('aria-expanded', String(!toHidden));
      if (!sec.classList.contains('hidden')) {
        sec.classList.add('animate__animated', 'animate__fadeIn');
        setTimeout(() => sec.classList.remove('animate__animated', 'animate__fadeIn'), 800);
      }
    }

    function sendToWhatsApp() {
      if (!cart.length) { alert('El carrito está vacío.'); return; }
      let message = '¡Hola! Quiero realizar el siguiente pedido:\n\n';
      cart.forEach((item) => {
        message += `${item.name} (${item.type})\n`;
        message += `Color: ${item.color}\n`;
        message += `Talle: ${item.size}\n`;
        message += `Cantidad: ${item.quantity}\n`;
        message += `Subtotal: $${item.subtotal.toFixed(2)}\n\n`;
      });
      message += `Total: $${cart.reduce((t, i) => t + i.subtotal, 0).toFixed(2)}`;
      const encoded = encodeURIComponent(message);
      const phone = '+5491154272065';
      window.open(`https://wa.me/${phone}?text=${encoded}`, '_blank');
    }
  </script>
</body>
</html>
