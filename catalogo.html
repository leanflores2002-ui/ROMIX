<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROMIX - Catálogo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <style>
    :root { --primary:#e83e8c; --secondary:#6f42c1; --success:#28a745; --danger:#dc3545; --light:#f8f9fa; --dark:#1b1f24; }
    * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { margin:0; background:#fff1f6; color:#232323; }
    header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color:#fff; padding:14px 0; box-shadow:0 4px 14px rgba(0,0,0,.12); }
    .header-wrap { max-width:1200px; margin:0 auto; padding:0 20px; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-size:1.4rem; font-weight:900; display:flex; align-items:center; gap:8px; }
    nav ul { list-style:none; display:flex; gap:10px; padding:0; margin:0; }
    nav a { color:#fff; text-decoration:none; padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.08); }
    .cart-btn { display:inline-flex; align-items:center; gap:6px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.5); color:#fff; padding:8px 12px; border-radius:999px; cursor:pointer; }
    .cart-count { background: var(--danger); color:#fff; border-radius:999px; padding:0 6px; font-size:.8rem; }

    .container { max-width:1200px; margin:18px auto; padding:0 20px; }
    .summary { color:#6c757d; margin: 6px 2px 12px; font-weight:600; }

    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:18px; }
    .card { background:#fff; border-radius:14px; box-shadow:0 14px 36px rgba(0,0,0,.10); overflow:hidden; display:flex; flex-direction:column; }
    .thumb { position:relative; height:200px; background:#f8f9fb; display:flex; align-items:center; justify-content:center; }
    .thumb img { max-width:100%; max-height:100%; object-fit:contain; }
    .badge { position:absolute; top:10px; right:10px; background:#f1f3f5; color:#6c757d; border-radius:999px; padding:6px 10px; font-size:.8rem; font-weight:800; box-shadow:0 6px 16px rgba(0,0,0,.12); }
    .body { padding:12px 14px; display:flex; flex-direction:column; gap:8px; }
    .title { font-size:1.05rem; font-weight:900; color:#111; }
    .subtitle { color:#6c757d; font-size:.95rem; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .price { color: var(--primary); font-weight:900; font-size:1.2rem; }
    .stock { color: var(--success); font-weight:800; font-size:.9rem; text-align:right; }
    .stock small { display:block; color:#6c757d; font-weight:600; }
    .actions { display:flex; gap:10px; margin-top:4px; }
    .btn { flex:1; display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #e9ecef; cursor:pointer; font-weight:800; text-decoration:none; }
    .btn-details { background:#fff; color:#495057; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color:#fff; border:none; }
    .btn:hover { filter:brightness(.98); }

    @media (max-width: 520px) {
      .thumb { height: 180px; }
    }
    .skip-link:focus{left:12px;top:12px;z-index:9999;background:#fff;color:#000;padding:8px 10px;border-radius:8px;position:absolute}
    footer{background:#fff;border-top:1px solid #e9ecef;margin-top:24px}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:16px 20px;display:flex;gap:18px;flex-wrap:wrap;color:#495057}
    .footer-wrap a{color:#495057;text-decoration:none}
    .footer-wrap a:hover{color:var(--primary)}
  </style>
  <script>
    const PLACEHOLDER = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`\
      <svg xmlns="http://www.w3.org/2000/svg" width="600" height="400">\
        <rect width="100%" height="100%" fill="#f8f9fb"/>\
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#adb5bd" font-family="Segoe UI, sans-serif" font-size="22">Imagen no disponible</text>\
      </svg>`);

    function slugify(s){
      try { return (s||'').normalize('NFD').replace(/\p{Diacritic}+/gu,'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,''); }
      catch { return String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,''); }
    }

    function estimateStock(p){
      try {
        if (typeof p.stock === 'number') return Math.max(0, p.stock);
        const sizes = Array.isArray(p.sizes) ? p.sizes : [];
        const perSize = sizes.reduce((t, s) => {
          const st = String(s.status||'').toLowerCase();
          if (st.includes('out') || st.includes('unavail')) return t;
          if (st.includes('low')) return t + 2; // bajo
          return t + 5; // normal
        }, 0);
        const colorsCount = Array.isArray(p.colors) && p.colors.length ? p.colors.length : (p.images ? Object.keys(p.images).length : 1);
        const total = perSize * Math.max(1, colorsCount);
        return total;
      } catch { return 0; }
    }

    function safeGetCart(){ try { return JSON.parse(localStorage.getItem('cart')||'[]'); } catch { return []; } }
    function safeSetCart(v){ try { localStorage.setItem('cart', JSON.stringify(v)); } catch {} }
    function updateCartCount(){
      const c = safeGetCart();
      const n = c.reduce((t,i)=>t + (i.quantity||0), 0);
      const el = document.getElementById('cart-count'); if (el) el.textContent = String(n);
    }
    function quickAdd(product){
      const cart = safeGetCart();
      const color = (product.colors && product.colors[0] && product.colors[0].name) || 'Único';
      let size = 'U';
      if (Array.isArray(product.sizes) && product.sizes.length){
        const available = product.sizes.find(s => !/out|unavail/i.test(String(s.status||''))) || product.sizes[0];
        size = String(available.size || 'U');
      }
      const price = Number(product.price||0);
      cart.push({ id: Date.now(), name: product.name, type: product.type || '', color, size, quantity: 1, price, subtotal: price });
      safeSetCart(cart);
      updateCartCount();
      alert('Listo! Se agregó al carrito.');
    }

    function renderCards(list){
      const grid = document.getElementById('grid');
      const summary = document.getElementById('summary');
      if (!Array.isArray(list)) { grid.innerHTML = '<p>No hay productos para mostrar.</p>'; return; }
      summary.textContent = `Mostrando ${list.length} de ${list.length} productos • Página 1 de 1`;
      grid.innerHTML = list.map(p => {
        const img = p.image || (p.images && (p.images['Negro'] || Object.values(p.images)[0])) || PLACEHOLDER;
        const price = Number(p.price||0).toLocaleString('es-AR');
        const slug = slugify(p.name);
        const stock = estimateStock(p);
        const badge = p.badge ? p.badge : (p.type || '');
        return `
          <article class="card" aria-label="${p.name}">
            <div class="thumb">
              <img src="${img}" alt="${p.name}" onerror="this.onerror=null;this.src='${PLACEHOLDER}';"/>
              ${badge?`<span class="badge">${badge}</span>`:''}
            </div>
            <div class="body">
              <div class="title">${p.name}</div>
              <div class="subtitle">${p.section ? (p.section.charAt(0).toUpperCase()+p.section.slice(1)) : ''}${p.type ? (p.section? ' • ' : '') + p.type : ''}</div>
              <div class="row">
                <div class="price">$${price}</div>
                <div class="stock">Disponible<small>Stock: ${stock}</small></div>
              </div>
              <div class="actions">
                <a class="btn btn-details" href="detalle.html?slug=${slug}" aria-label="Ver detalles de ${p.name}"><i class="fas fa-info-circle" aria-hidden="true"></i> Ver Detalles</a>
                <button class="btn btn-primary" type="button" onclick='quickAdd(${JSON.stringify({name: "__placeholder__"}).replace("\"__placeholder__\"","JSON.stringify(p)")})'><i class="fas fa-cart-plus" aria-hidden="true"></i> Agregar</button>
              </div>
            </div>
          </article>`;
      }).join('');
    }

    // Workaround to inline object in onclick without escaping issues
    function JSON_stringify(o){ return JSON.stringify(o).replace(/</g,'\\u003C').replace(/>/g,'\\u003E').replace(/&/g,'\\u0026'); }

    async function init(){
      updateCartCount();
      try {
        const res = await fetch('products.json');
        const list = await res.json();
        // Render with a small adapter so we can safely pass product to quickAdd
        const grid = document.getElementById('grid');
        const summary = document.getElementById('summary');
        if (!Array.isArray(list)) { grid.innerHTML = '<p>No hay productos.</p>'; return; }
        summary.textContent = `Mostrando ${list.length} de ${list.length} productos • Página 1 de 1`;
        grid.innerHTML = '';
        list.forEach(p => {
          const img = p.image || (p.images && (p.images['Negro'] || Object.values(p.images)[0])) || PLACEHOLDER;
          const price = Number(p.price||0).toLocaleString('es-AR');
          const slug = slugify(p.name);
          const stock = estimateStock(p);
          const badge = p.badge ? p.badge : (p.type || '');
          const card = document.createElement('article');
          card.className = 'card';
          card.setAttribute('aria-label', p.name);
          card.innerHTML = `
            <div class="thumb">
              <img src="${img}" alt="${p.name}" onerror="this.onerror=null;this.src='${PLACEHOLDER}';"/>
              ${badge?`<span class=\"badge\">${badge}</span>`:''}
            </div>
            <div class="body">
              <div class="title">${p.name}</div>
              <div class="subtitle">${p.section ? (p.section.charAt(0).toUpperCase()+p.section.slice(1)) : ''}${p.type ? (p.section? ' • ' : '') + p.type : ''}</div>
              <div class="row">
                <div class="price">$${price}</div>
                <div class="stock">Disponible<small>Stock: ${stock}</small></div>
              </div>
              <div class="actions">
                <a class="btn btn-details" href="detalle.html?slug=${slug}" aria-label="Ver detalles de ${p.name}"><i class="fas fa-info-circle" aria-hidden="true"></i> Ver Detalles</a>
                <button class="btn btn-primary" type="button"><i class="fas fa-cart-plus" aria-hidden="true"></i> Agregar</button>
              </div>
            </div>`;
          const addBtn = card.querySelector('.btn.btn-primary');
          addBtn.addEventListener('click', () => quickAdd(p));
          document.getElementById('grid').appendChild(card);
        });
      } catch (e) {
        document.getElementById('grid').innerHTML = '<p>Error al cargar productos.</p>';
        console && console.error && console.error('[catalogo] Error:', e);
      }
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</head>
<body>
  <header>
    <div class="header-wrap">
      <div class="logo"><i class="fas fa-store" aria-hidden="true"></i> ROMIX</div>
      <nav aria-label="Secciones">
        <ul>
          <li><a href="mujer.html">Mujer</a></li>
          <li><a href="hombre.html">Hombre</a></li>
          <li><a href="ninos.html">Niños</a></li>
          <li><a href="ayuda.html">Ayuda</a></li>
        </ul>
      </nav>
      <div>
        <button class="cart-btn" type="button" onclick="alert('Abrí el detalle de cualquier producto para finalizar compra.');">
          <i class="fas fa-shopping-cart" aria-hidden="true"></i> Carrito <span id="cart-count" class="cart-count">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="container" aria-label="Catálogo de productos">
    <div id="summary" class="summary">Mostrando 0 productos • Página 1 de 1</div>
    <section id="grid" class="grid" aria-live="polite"></section>
  </main>
  <footer>
    <div class="footer-wrap" role="contentinfo">
      <div>
        <strong>Ayuda</strong>
        <div>
          <a href="ayuda.html#size-guide">Guía de talles</a> •
          <a href="ayuda.html#returns">Cambios y devoluciones</a> •
          <a href="ayuda.html">Centro de ayuda</a>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>
